<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Pet - Happy Pets</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="stylesheet" href="styles.css?v=7">
  <link rel="stylesheet" href="forms.css?v=8">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="pet-header" style="background: linear-gradient(135deg, #95D5B2 0%, #B8E6C9 100%);">
      <a href="index.html" class="back-button">â†</a>
      <div class="pet-avatar add" style="background: rgba(255,255,255,0.9);">ğŸ¾</div>
      <h1 class="pet-name">Add a Pet</h1>
      <p class="pet-type">Tell us about your furry friend!</p>
    </header>

    <!-- Add Pet Form -->
    <form id="add-pet-form" class="form-section">
      <div class="form-group">
        <label for="pet-name">Pet's Name</label>
        <input type="text" id="pet-name" placeholder="What's their name?" required>
      </div>

      <div class="form-group">
        <label>What kind of pet?</label>
        <div class="pet-type-grid">
          <label class="pet-type-option">
            <input type="radio" name="pet-type" value="dog" required>
            <span class="pet-type-card">
              <span class="pet-type-icon">ğŸ¶</span>
              <span class="pet-type-label">Dog</span>
            </span>
          </label>
          <label class="pet-type-option">
            <input type="radio" name="pet-type" value="cat">
            <span class="pet-type-card">
              <span class="pet-type-icon">ğŸ±</span>
              <span class="pet-type-label">Cat</span>
            </span>
          </label>
          <label class="pet-type-option">
            <input type="radio" name="pet-type" value="hamster">
            <span class="pet-type-card">
              <span class="pet-type-icon">ğŸ¹</span>
              <span class="pet-type-label">Hamster</span>
            </span>
          </label>
          <label class="pet-type-option">
            <input type="radio" name="pet-type" value="bird">
            <span class="pet-type-card">
              <span class="pet-type-icon">ğŸ¦</span>
              <span class="pet-type-label">Bird</span>
            </span>
          </label>
          <label class="pet-type-option">
            <input type="radio" name="pet-type" value="fish">
            <span class="pet-type-card">
              <span class="pet-type-icon">ğŸŸ</span>
              <span class="pet-type-label">Fish</span>
            </span>
          </label>
          <label class="pet-type-option">
            <input type="radio" name="pet-type" value="rabbit">
            <span class="pet-type-card">
              <span class="pet-type-icon">ğŸ°</span>
              <span class="pet-type-label">Rabbit</span>
            </span>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label for="pet-breed">Breed (optional)</label>
        <input type="text" id="pet-breed" placeholder="e.g., Golden Retriever">
      </div>

      <div class="form-group">
        <label>What care does your pet need?</label>
        <div class="task-checklist">
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="feed-morning" checked>
            <span class="task-check-card">ğŸ¥£ Morning Food</span>
          </label>
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="feed-evening" checked>
            <span class="task-check-card">ğŸ¥£ Evening Food</span>
          </label>
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="water" checked>
            <span class="task-check-card">ğŸ’§ Fresh Water</span>
          </label>
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="walk">
            <span class="task-check-card">ğŸš¶ Walk</span>
          </label>
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="play" checked>
            <span class="task-check-card">ğŸ¾ Playtime</span>
          </label>
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="brush">
            <span class="task-check-card">ğŸª¥ Brush Fur</span>
          </label>
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="clean">
            <span class="task-check-card">ğŸ§¹ Clean Cage/Litter</span>
          </label>
          <label class="task-check-option">
            <input type="checkbox" name="tasks" value="check">
            <span class="task-check-card">ğŸ‘€ Health Check</span>
          </label>
        </div>
      </div>

      <button type="submit" class="submit-button" id="submit-btn">
        <span>Add My Pet</span>
        <span class="button-icon">ğŸ¾</span>
      </button>
    </form>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
      <a href="index.html" class="nav-item">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-label">Home</span>
      </a>
      <a href="today.html" class="nav-item">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-label">Today</span>
      </a>
      <a href="memories.html" class="nav-item">
        <span class="nav-icon">ğŸ“¸</span>
        <span class="nav-label">Memories</span>
      </a>
      <a href="family.html" class="nav-item">
        <span class="nav-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span>
        <span class="nav-label">Family</span>
      </a>
    </nav>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js?v=3"></script>
  <script src="app.js?v=7"></script>
  <script>
    // Check auth
    if (!requireAuth()) {
      // Redirect handled by requireAuth
    }

    document.getElementById('add-pet-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span>Adding pet...</span>';

      const name = document.getElementById('pet-name').value;
      const type = document.querySelector('input[name="pet-type"]:checked').value;
      const breed = document.getElementById('pet-breed').value;
      const taskCheckboxes = document.querySelectorAll('input[name="tasks"]:checked');
      const tasks = Array.from(taskCheckboxes).map(cb => cb.value);

      try {
        const newPet = await addPetToFirestore({ name, type, breed, tasks });
        // Go directly to edit page to add tasks/chores
        window.location.href = `edit-pet.html?id=${newPet.id}`;
      } catch (error) {
        alert('Error adding pet: ' + error.message);
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>Add My Pet</span><span class="button-icon">ğŸ¾</span>';
      }
    });
  </script>
</body>
</html>
